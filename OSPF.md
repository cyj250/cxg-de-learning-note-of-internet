## 因特网中自治系统内部的路由选择：OSPF

已学习的路由选择算法需要将每台路由器看作一个点进行计算，存在着以下问题

* 规模：随着路由器数目变得很大，涉及的通信、计算、存储的开销将难以实现。
* 管理自治：因特网是ISP的网络，在内部希望按自己的愿望运行和管理网络，并且与其他网络连接起来。

**自治系统**

每一个AS由一组通常处在相同管理控制下的路由器组成。一个自治系统由其全局唯一的AS号所标识。

在相同AS中运行相同的路由选择算法且有彼此的信息----自治系统内部路由选择协议



**开放最短路径优先OSPF**

* OSPF是一种链路状态算法，使用泛洪链路状态信息和Dijkstra算法。
* OSPF优点包括：安全、多条相同开销路径、对单播与多播路由选择的综合支持、支持在单个AS中的层次结构。



## ISP之间的路由选择：BGP

AS间的通信需要一个**自治系统间路由选择协议**，所有AS运行相同的AS间路由选择协议称为**边界网关协议**。



**BGP的作用**

在BGP中分组路由到CIDR化的前缀，其中每个前缀表示一个子网或一个子网的集合。

BGP为每台路由器提供了以下手段：

1. 从邻居AS获得前缀的可达性信息。
2. 确定到达该前缀的“最好的”路由。这种路由基于策略和可达性信息来确定。



**eBGP**：跨越两个AS的BGP连接

**iBGP**：在相同AS中两台路由器之间的连接



**热土豆路由选择**

1. 从AS间协议学到经过多个网关可达子网x；
2. 使用来自AS内部协议的路由选择信息，确定到达每个网关的最低开销路径的开销；
3. 热土豆路由选择选择具有最小最低开销的网关；
4. 从转发表确定通往最低开销网关的接口I。在转发表中加入表项（x，I）。

**路由选择规则**

1. 路由被指派一个本地偏好值作为属性之一，具有最高本地偏好值得路由将被选择；
2. 从余下的路由中选择最短AS-PATH的路由；
3. 从余下路由中使用热土豆路由选择，即选择具有靠近NEXT-HOP路由器的路由；
4. 如果仍有预留，根据BGP标识符来选择路由。



**路由选择策略**

AS间路由选择是面向策略的，不同ISP、政治等多方面因素影响了AS间的路由选择。